# 高校智能排课选课管理系统设计报告

**小组成员：**
*   姓名：赵骥远  学号：[学号]
*   姓名：朱城宇  学号：[学号]

**完成日期：** 2024年12月

---

## 一. 需求分析

### 1. 任务分配
| 学生姓名 | 工作内容 | 工作量占比（组内同学总和为1） |
| :--- | :--- | :--- |
| 赵骥远 | 子任务1：系统前端界面设计与**学生选课**功能数据库操作实现<br>子任务2：系统后端逻辑开发与**教师授课**功能数据库操作实现 | 0.5 |
| 朱城宇 | 子任务1：系统功能模块设计与**教务排课**功能数据库操作实现<br>子任务2：系统数据库整体设计与**用户管理**功能数据库操作实现 | 0.5 |

### 2. 需求描述
本系统旨在为高校提供一个高效、智能的排课与选课管理平台。系统需要满足以下核心需求：
1.  **多角色支持**：系统需支持学生、教师、教务管理员三种角色，不同角色拥有不同的权限和操作界面。
2.  **基础数据管理**：教务管理员需能够管理院系、教室、课程、学期、时间段等基础数据。
3.  **排课管理**：教务管理员需能够创建开课实例，安排上课时间、地点和授课教师，系统需自动检测时间与地点冲突。
4.  **选课功能**：学生能够在规定时间内进行选课，系统需实时检测名额限制、时间冲突、跨院系名额限制等。
5.  **课表查询**：学生和教师可以查看个人的学期课表，支持按周次展示。
6.  **数据统计**：管理员可查看选课情况统计，教师可查看所授课程的学生名单。

### 3. 数据流图 (DFD)

#### 顶层图 (Level-0)
用户（学生/教师/管理员）通过 Web 界面发送请求（登录、查询、操作），系统处理请求并读写数据库，返回操作结果或数据视图。

#### 0 层图 (Level-1)
主要包含以下数据流：
1.  **身份验证流**：用户提交凭证 -> 身份验证模块 -> 验证结果。
2.  **排课管理流**：管理员提交排课信息 -> 冲突检测模块 -> 写入开课实例表/上课时间表。
3.  **选课处理流**：学生提交选课申请 -> 选课校验模块（触发器） -> 写入选课记录表 -> 更新名额。
4.  **查询流**：用户请求课表 -> 查询模块 -> 读取视图 -> 返回课表数据。

### 4. 数据字典

#### （1）数据组名：用户信息
| 数据项名 | 用户ID | 学号_工号 | 姓名 | 密码哈希 | 角色 | 院系ID |
| :--- | :--- | :--- | :--- | :--- | :--- | :--- |
| 数据类型 | int | varchar | varchar | varchar | enum | int |
| 数据宽度 | 11 | 20 | 50 | 255 | / | 11 |
| 值约束 | 主键 | 唯一 | 非空 | 非空 | 学生/教师/教务 | 外键 |
| 允许空值 | 否 | 否 | 否 | 否 | 否 | 否 |

#### （2）数据组名：课程信息
| 数据项名 | 课程ID | 课程名称 | 学分 | 院系ID |
| :--- | :--- | :--- | :--- | :--- |
| 数据类型 | varchar | varchar | decimal | int |
| 数据宽度 | 20 | 100 | 3,1 | 11 |
| 值约束 | 主键 | 非空 | >0 | 外键 |
| 允许空值 | 否 | 否 | 否 | 否 |

#### （3）数据组名：开课实例
| 数据项名 | 开课实例ID | 课程ID | 教室ID | 学期ID | 对内名额 | 对外名额 | 已选对内 | 已选对外 |
| :--- | :--- | :--- | :--- | :--- | :--- | :--- | :--- | :--- |
| 数据类型 | int | varchar | int | int | int | int | int | int |
| 数据宽度 | 11 | 20 | 11 | 11 | 11 | 11 | 11 | 11 |
| 值约束 | 主键 | 外键 | 外键 | 外键 | >0 | >=0 | >=0 | >=0 |
| 允许空值 | 否 | 否 | 否 | 否 | 否 | 否 | 否 | 否 |

#### （4）数据组名：选课记录
| 数据项名 | 学生ID | 开课实例ID | 选课时间 |
| :--- | :--- | :--- | :--- |
| 数据类型 | int | int | timestamp |
| 数据宽度 | 11 | 11 | / |
| 值约束 | 主键/外键 | 主键/外键 | 默认当前时间 |
| 允许空值 | 否 | 否 | 否 |

#### （5）数据组名：上课时间
| 数据项名 | 上课时间ID | 开课实例ID | 时间段ID | 教师ID | 起始周 | 结束周 | 单双周 |
| :--- | :--- | :--- | :--- | :--- | :--- | :--- | :--- |
| 数据类型 | int | int | int | int | int | int | enum |
| 数据宽度 | 11 | 11 | 11 | 11 | 11 | 11 | / |
| 值约束 | 主键 | 外键 | 外键 | 外键 | 1-20 | >=起始周 | 全部/单/双 |
| 允许空值 | 否 | 否 | 否 | 是 | 否 | 否 | 否 |

---

## 二. 数据库概念模式设计

### 1. 实体与属性
*   **用户**：具有唯一标识 ID，包含学号/工号、姓名、密码、所属院系等属性。
*   **课程**：包含课程代码、名称、学分、所属院系。
*   **教室**：包含教学楼、房间号、容量。
*   **学期**：包含学年、学期类型（春/秋）、起止日期、选课时间窗口。
*   **时间段**：定义了每天的上课节次（如星期一第一节）。

### 2. 实体间联系
*   **开课**：课程在特定学期、特定教室开设，形成“开课实例”。(1:N)
*   **授课**：教师教授某个开课实例，支持多教师授课。(M:N)
*   **选课**：学生选择某个开课实例。(M:N)
*   **排课**：开课实例占用特定的时间段，并指定周次范围。(M:N)

---

## 三. 数据库逻辑模式设计

### 1. 数据库关系模式

#### 1.1 实体表
*   **院系信息表**(`院系ID`, 院系名称)
*   **教室信息表**(`教室ID`, 教学楼, 房间号, 容量)
*   **时间段信息表**(`时间段ID`, 星期, 开始时间, 结束时间)
*   **学期信息表**(`学期ID`, 学年, 学期类型, 选课时间窗口...)
*   **课程信息表**(`课程ID`, 课程名称, 学分, 院系ID)
*   **用户信息表**(`用户ID`, 学号_工号, 姓名, 密码, 角色, 院系ID)

#### 1.2 核心业务表
*   **开课实例表**(`开课实例ID`, 课程ID, 教室ID, 学期ID, 名额信息...)
*   **上课时间表**(`上课时间ID`, 开课实例ID, 时间段ID, 教师ID, 周次范围...)

#### 1.3 联系表
*   **授课关系表**(`教师ID`, `开课实例ID`)
*   **选课记录表**(`学生ID`, `开课实例ID`, 选课时间)

### 2. 规范化分析 (3NF)
*   **1NF**：所有字段均为原子值，不可再分。
*   **2NF**：所有非主属性完全依赖于主键。例如在`选课记录表`中，`选课时间`完全依赖于(`学生ID`, `开课实例ID`)。
*   **3NF**：不存在传递依赖。例如`用户信息表`中，`院系ID`直接依赖于`用户ID`，而不通过其他非主属性传递。
*   **特殊处理**：为了查询效率，在`开课实例表`中冗余存储了`已选人数`，这虽然轻微违反范式（可以通过统计`选课记录表`获得），但通过触发器维护一致性，显著提高了高并发下的查询性能。

### 3. 数据库设计优化

#### 3.1 索引设计
*   **唯一索引**：`uk_学号_工号`、`uk_教学楼_房间号` 保证数据唯一性。
*   **外键索引**：所有外键字段（如`院系ID`、`课程ID`）均建立索引，加速连接查询。
*   **复合索引**：`idx_学期_课程` (`学期ID`, `课程ID`) 用于快速查找某学期的某门课。

#### 3.2 视图设计
*   **当前学期开课实例视图**：自动筛选当前学期数据，并计算剩余名额（对内/对外），简化前端查询逻辑。
*   **学生选课详情视图**：连接多表，直接提供学生选课列表所需的完整信息（课程名、时间、地点）。

#### 3.3 存储过程与事务
*   **sp_add_classroom**：封装教室添加逻辑，包含参数校验和重复性检查。
*   **sp_student_enroll**：封装选课逻辑，利用事务保证数据一致性，防止超卖。

#### 3.4 触发器 (核心逻辑)
*   **trg_before_enroll_check**：在插入选课记录前触发。
    *   检查是否本院系学生，分别判断对内/对外名额。
    *   检查选课时间窗口。
    *   检查是否重复选课。
    *   **冲突检测**：检查该学生已选课程的时间段是否与新课冲突（考虑周次重叠）。
*   **trg_after_enroll**：选课成功后，自动更新`开课实例表`中的已选人数。

---

## 四. 系统实现与界面展示

### 1. 技术栈
*   **前端**：Vue 3, Vite, Vue Router, Pinia, Axios
*   **后端**：Python FastAPI, Pydantic
*   **数据库**：MySQL 8.0

### 2. 核心功能界面
*   **登录页**：采用赛博朋克风格设计，支持多角色登录。
*   **仪表盘**：不同角色展示不同的统计卡片和背景图（北航主题）。
*   **选课中心**：卡片式展示课程，实时显示剩余名额，支持一键选课。
*   **我的课表**：网格化展示每周课程安排，区分单双周。

### 3. 亮点功能
*   **严格的冲突检测**：数据库层面的触发器保证了选课的绝对安全，杜绝时间冲突。
*   **精细的名额控制**：区分本院系与外院系名额，保护本专业学生权益。
*   **美观的交互设计**：全站统一的视觉风格，响应式布局，友好的操作反馈。
