# API ä½¿ç”¨æŒ‡å— - Swagger UI å®Œå…¨æ•™ç¨‹

## ğŸ“– ç›®å½•
1. [Swagger UI ç•Œé¢ä»‹ç»](#ç•Œé¢ä»‹ç»)
2. [å¦‚ä½•æµ‹è¯• API](#æµ‹è¯•æ­¥éª¤)
3. [å®Œæ•´ä½¿ç”¨æµç¨‹](#å®Œæ•´æµç¨‹)
4. [å¸¸è§åœºæ™¯ç¤ºä¾‹](#ä½¿ç”¨åœºæ™¯)

---

## ğŸ¯ ç•Œé¢ä»‹ç»

æ‰“å¼€ http://localhost:8000/docs åï¼Œæ‚¨ä¼šçœ‹åˆ°ï¼š

### é¡¶éƒ¨åŒºåŸŸ
- **æ ‡é¢˜**ï¼šé«˜æ ¡æ™ºèƒ½æ’è¯¾é€‰è¯¾ç®¡ç†ç³»ç»Ÿ API
- **ç‰ˆæœ¬å·**ï¼š1.0.0
- **Authorize æŒ‰é’®**ï¼šğŸ”’ ç”¨äºè¾“å…¥ JWT ä»¤ç‰Œï¼ˆç™»å½•åä½¿ç”¨ï¼‰

### API åˆ†ç»„
- **ğŸ  Root**ï¼šåŸºç¡€æ¥å£ï¼ˆå¥åº·æ£€æŸ¥ï¼‰
- **ğŸ” è®¤è¯ (auth)**ï¼šç™»å½•ã€åˆ·æ–°ä»¤ç‰Œ
- **ğŸ‘¨â€ğŸ“ å­¦ç”Ÿ (students)**ï¼šé€‰è¯¾ã€é€€è¯¾ã€æŸ¥çœ‹è¯¾è¡¨
- **ğŸ‘¨â€ğŸ« æ•™å¸ˆ (teachers)**ï¼šæŸ¥çœ‹æˆè¯¾è¡¨ã€å­¦ç”Ÿåå•
- **ğŸ“Š ç»Ÿè®¡ (statistics)**ï¼šé€‰è¯¾ç»Ÿè®¡ã€ç³»ç»Ÿæ¦‚è§ˆ

### æ¯ä¸ª API ç«¯ç‚¹æ˜¾ç¤º
- **HTTP æ–¹æ³•**ï¼š`GET`ï¼ˆç»¿è‰²ï¼‰ã€`POST`ï¼ˆè“è‰²ï¼‰ç­‰
- **è·¯å¾„**ï¼šå¦‚ `/api/auth/login`
- **æè¿°**ï¼šåŠŸèƒ½è¯´æ˜

---

## ğŸš€ æµ‹è¯•æ­¥éª¤ï¼ˆä»¥ç™»å½•ä¸ºä¾‹ï¼‰

### ç¬¬ä¸€æ­¥ï¼šå±•å¼€æ¥å£
ç‚¹å‡» **`POST /api/auth/login`** è¡Œï¼Œå±•å¼€è¯¦æƒ…

### ç¬¬äºŒæ­¥ï¼šç‚¹å‡» "Try it out"
åœ¨å³ä¸Šè§’æ‰¾åˆ° **"Try it out"** æŒ‰é’®å¹¶ç‚¹å‡»

### ç¬¬ä¸‰æ­¥ï¼šå¡«å†™è¯·æ±‚å‚æ•°
åœ¨ **Request body** åŒºåŸŸï¼Œæ‚¨ä¼šçœ‹åˆ°ç¤ºä¾‹ JSONï¼š

```json
{
  "username": "string",
  "password": "string"
}
```

**ä¿®æ”¹ä¸ºçœŸå®æ•°æ®**ï¼ˆä½¿ç”¨æµ‹è¯•è´¦å·ï¼‰ï¼š

```json
{
  "username": "2021001",
  "password": "123456"
}
```

### ç¬¬å››æ­¥ï¼šæ‰§è¡Œè¯·æ±‚
ç‚¹å‡»è“è‰²çš„ **"Execute"** æŒ‰é’®

### ç¬¬äº”æ­¥ï¼šæŸ¥çœ‹å“åº”
å‘ä¸‹æ»šåŠ¨ï¼Œæ‚¨ä¼šçœ‹åˆ°ï¼š

#### âœ… æˆåŠŸå“åº”ï¼ˆ200ï¼‰
```json
{
  "success": true,
  "message": "ç™»å½•æˆåŠŸ",
  "data": {
    "access_token": "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...",
    "refresh_token": "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...",
    "token_type": "bearer",
    "user_info": {
      "user_id": 16,
      "username": "2021001",
      "real_name": "å¼ ä¸‰",
      "role": "å­¦ç”Ÿ",
      "department_name": "è®¡ç®—æœºå­¦é™¢"
    }
  }
}
```

**é‡è¦**ï¼šå¤åˆ¶ `access_token` çš„å€¼ï¼ˆå¾ˆé•¿çš„å­—ç¬¦ä¸²ï¼‰ï¼

---

## ğŸ” é…ç½®è®¤è¯ï¼ˆè®¿é—®éœ€è¦ç™»å½•çš„æ¥å£ï¼‰

å¤§éƒ¨åˆ†æ¥å£éœ€è¦ç™»å½•æ‰èƒ½è®¿é—®ã€‚é…ç½®æ­¥éª¤ï¼š

### 1. å¤åˆ¶ Token
ä»ç™»å½•å“åº”ä¸­å¤åˆ¶å®Œæ•´çš„ `access_token` å€¼

### 2. ç‚¹å‡» Authorize æŒ‰é’®
åœ¨é¡µé¢å³ä¸Šè§’æ‰¾åˆ° ğŸ”’ **"Authorize"** æŒ‰é’®

### 3. è¾“å…¥ Token
åœ¨å¼¹å‡ºçš„å¯¹è¯æ¡†ä¸­ï¼Œæ‰¾åˆ° **"HTTPBearer (http, Bearer)"** éƒ¨åˆ†

åœ¨ **Value** è¾“å…¥æ¡†ä¸­è¾“å…¥ï¼š
```
Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...
```

âš ï¸ **æ³¨æ„**ï¼š
- å¿…é¡»ä»¥ `Bearer ` å¼€å¤´ï¼ˆBearer åé¢æœ‰ä¸ªç©ºæ ¼ï¼‰
- åé¢è·Ÿå®Œæ•´çš„ token å­—ç¬¦ä¸²

### 4. ç‚¹å‡» Authorize
ç‚¹å‡»å¯¹è¯æ¡†ä¸­çš„ **"Authorize"** æŒ‰é’®

### 5. å…³é—­å¯¹è¯æ¡†
ç‚¹å‡» **"Close"** å…³é—­å¯¹è¯æ¡†

**é…ç½®æˆåŠŸæ ‡å¿—**ï¼š
- ğŸ”’ æŒ‰é’®å˜æˆ ğŸ”“ï¼ˆè§£é”å›¾æ ‡ï¼‰
- æ‰€æœ‰æ¥å£å³ä¾§å‡ºç° ğŸ”’ å›¾æ ‡

---

## ğŸ“š å®Œæ•´ä½¿ç”¨æµç¨‹

### åœºæ™¯ä¸€ï¼šå­¦ç”Ÿé€‰è¯¾æµç¨‹

#### Step 1: ç™»å½•
```
POST /api/auth/login
```
**è¯·æ±‚**ï¼š
```json
{
  "username": "2021001",
  "password": "123456"
}
```
**æ“ä½œ**ï¼šå¤åˆ¶è¿”å›çš„ `access_token`ï¼Œé…ç½® Authorize

---

#### Step 2: æŸ¥çœ‹å¯é€‰è¯¾ç¨‹
```
GET /api/students/{student_id}/available-courses
```

1. ç‚¹å‡» "Try it out"
2. å¡«å†™å‚æ•°ï¼š
   - **student_id**: `16` ï¼ˆå¼ ä¸‰çš„ç”¨æˆ·IDï¼Œä»ç™»å½•å“åº”çš„ `user_id` è·å–ï¼‰
3. ç‚¹å‡» "Execute"

**å“åº”ç¤ºä¾‹**ï¼š
```json
{
  "success": true,
  "data": [
    {
      "instance_id": 1,
      "course_name": "æ•°æ®åº“ç³»ç»Ÿ",
      "teacher_name": "å¼ æ•™æˆ",
      "credits": 3,
      "capacity": 60,
      "enrolled": 2,
      "available": 58
    }
  ]
}
```

**è®°ä½**ï¼šè¦é€‰çš„è¯¾ç¨‹çš„ `instance_id`ï¼ˆå¦‚ï¼š1ï¼‰

---

#### Step 3: é€‰è¯¾
```
POST /api/students/{student_id}/enroll
```

1. ç‚¹å‡» "Try it out"
2. å¡«å†™å‚æ•°ï¼š
   - **student_id**: `16`
   - **Request body**:
     ```json
     {
       "instance_id": 1
     }
     ```
3. ç‚¹å‡» "Execute"

**æˆåŠŸå“åº”**ï¼š
```json
{
  "success": true,
  "message": "é€‰è¯¾æˆåŠŸ"
}
```

---

#### Step 4: æŸ¥çœ‹è¯¾è¡¨
```
GET /api/students/{student_id}/schedule
```

1. ç‚¹å‡» "Try it out"
2. å¡«å†™å‚æ•°ï¼š
   - **student_id**: `16`
   - **semester_id**: `4` ï¼ˆå¯é€‰ï¼Œä¸å¡«æŸ¥è¯¢æ‰€æœ‰å­¦æœŸï¼‰
3. ç‚¹å‡» "Execute"

**å“åº”ç¤ºä¾‹**ï¼š
```json
{
  "success": true,
  "data": [
    {
      "course_name": "æ•°æ®åº“ç³»ç»Ÿ",
      "teacher_name": "å¼ æ•™æˆ",
      "classroom_name": "æ•™å­¦æ¥¼A-101",
      "week_range": "1-16å‘¨",
      "day_of_week": 1,
      "time_slot": "08:00-09:40"
    }
  ]
}
```

---

#### Step 5: é€€è¯¾ï¼ˆå¦‚æœéœ€è¦ï¼‰
```
POST /api/students/{student_id}/drop
```

1. ç‚¹å‡» "Try it out"
2. å¡«å†™å‚æ•°ï¼š
   - **student_id**: `16`
   - **Request body**:
     ```json
     {
       "instance_id": 1
     }
     ```
3. ç‚¹å‡» "Execute"

---

### åœºæ™¯äºŒï¼šæ•™å¸ˆæŸ¥çœ‹å­¦ç”Ÿ

#### Step 1: æ•™å¸ˆç™»å½•
```json
{
  "username": "T001",
  "password": "123456"
}
```

#### Step 2: æŸ¥çœ‹æˆè¯¾è¡¨
```
GET /api/teachers/{teacher_id}/schedule
```

å‚æ•°ï¼š
- **teacher_id**: ä»ç™»å½•å“åº”è·å–
- **semester_id**: `4` ï¼ˆå¯é€‰ï¼‰

---

#### Step 3: æŸ¥çœ‹å­¦ç”Ÿåå•
```
GET /api/teachers/{teacher_id}/students
```

å‚æ•°ï¼š
- **teacher_id**: æ•™å¸ˆID
- **instance_id**: å¼€è¯¾å®ä¾‹ID

---

### åœºæ™¯ä¸‰ï¼šæŸ¥çœ‹ç»Ÿè®¡ä¿¡æ¯

#### é€‰è¯¾ç»Ÿè®¡
```
GET /api/statistics/enrollment
```

å¯é€‰å‚æ•°ï¼š
- **semester_id**: `4`
- **department_id**: `1`

#### ç³»ç»Ÿæ¦‚è§ˆ
```
GET /api/statistics/overview
```

æ— éœ€å‚æ•°ï¼Œç›´æ¥æ‰§è¡Œ

---

## ğŸ’¡ ä½¿ç”¨æŠ€å·§

### 1ï¸âƒ£ æŸ¥çœ‹ Schemaï¼ˆæ•°æ®æ¨¡å‹ï¼‰
æ¯ä¸ªæ¥å£ä¸‹æ–¹æœ‰ **"Schemas"** åŒºåŸŸï¼Œæ˜¾ç¤ºï¼š
- è¯·æ±‚ä½“çš„æ•°æ®ç»“æ„
- å“åº”ä½“çš„æ•°æ®ç»“æ„
- æ¯ä¸ªå­—æ®µçš„ç±»å‹å’Œè¯´æ˜

### 2ï¸âƒ£ æŸ¥çœ‹å“åº”çŠ¶æ€ç 
æ¯ä¸ªæ¥å£éƒ½åˆ—å‡ºäº†å¯èƒ½çš„å“åº”ï¼š
- **200**ï¼šæˆåŠŸ
- **400**ï¼šè¯·æ±‚å‚æ•°é”™è¯¯
- **401**ï¼šæœªè®¤è¯ï¼ˆéœ€è¦ç™»å½•ï¼‰
- **403**ï¼šæ— æƒé™
- **404**ï¼šèµ„æºä¸å­˜åœ¨
- **422**ï¼šä¸šåŠ¡é€»è¾‘é”™è¯¯ï¼ˆå¦‚é€‰è¯¾å†²çªï¼‰
- **500**ï¼šæœåŠ¡å™¨å†…éƒ¨é”™è¯¯

### 3ï¸âƒ£ å¤åˆ¶ä¸º cURL å‘½ä»¤
ç‚¹å‡» "Execute" åï¼Œå¯ä»¥çœ‹åˆ° **"Curl"** æ ‡ç­¾ï¼Œæ˜¾ç¤ºç­‰æ•ˆçš„å‘½ä»¤è¡Œå‘½ä»¤ï¼š

```bash
curl -X 'POST' \
  'http://localhost:8000/api/auth/login' \
  -H 'accept: application/json' \
  -H 'Content-Type: application/json' \
  -d '{
  "username": "2021001",
  "password": "123456"
}'
```

å¯ä»¥å¤åˆ¶åˆ°ç»ˆç«¯æ‰§è¡Œï¼

### 4ï¸âƒ£ æŸ¥çœ‹è¯·æ±‚è¯¦æƒ…
å±•å¼€ **"Request URL"**ã€**"Request headers"** æŸ¥çœ‹å®é™…å‘é€çš„è¯·æ±‚

---

## ğŸ” å¸¸è§é—®é¢˜

### Q: æç¤º 401 Unauthorizedï¼Ÿ
A: è¯´æ˜éœ€è¦ç™»å½•ã€‚æ“ä½œï¼š
1. å…ˆè°ƒç”¨ `/api/auth/login` ç™»å½•
2. å¤åˆ¶ `access_token`
3. ç‚¹å‡» ğŸ”’ **Authorize** é…ç½® Token
4. é‡æ–°æ‰§è¡Œæ¥å£

### Q: æç¤º 422 Unprocessable Entityï¼Ÿ
A: ä¸šåŠ¡é€»è¾‘é”™è¯¯ï¼ŒæŸ¥çœ‹å“åº”ä¸­çš„ `message` å­—æ®µï¼š
```json
{
  "success": false,
  "message": "è¯¥è¯¾ç¨‹ä¸å·²é€‰è¯¾ç¨‹æ—¶é—´å†²çª"
}
```

### Q: å¦‚ä½•æµ‹è¯•å¹¶å‘é€‰è¯¾ï¼Ÿ
A: 
1. åœ¨ Swagger UI ä¸­æµ‹è¯•å•ä¸ªè¯·æ±‚
2. ä½¿ç”¨ `test_connection.py` æŸ¥çœ‹æ•°æ®åº“çŠ¶æ€
3. å¦‚éœ€å‹åŠ›æµ‹è¯•ï¼Œä½¿ç”¨ Python è„šæœ¬æˆ– Postman

### Q: Token è¿‡æœŸäº†æ€ä¹ˆåŠï¼Ÿ
A: 
1. è°ƒç”¨ `/api/auth/refresh` åˆ·æ–° Token
2. æˆ–é‡æ–°ç™»å½•è·å–æ–° Token

---

## ğŸ“ æµ‹è¯•æ•°æ®

### å­¦ç”Ÿè´¦å·
| ç”¨æˆ·å | å¯†ç  | å§“å | å­¦é™¢ | ç”¨æˆ·ID |
|--------|------|------|------|--------|
| 2021001 | 123456 | å¼ ä¸‰ | è®¡ç®—æœºå­¦é™¢ | 16 |
| 2021002 | 123456 | æå›› | è®¡ç®—æœºå­¦é™¢ | 17 |
| 2021003 | 123456 | ç‹äº” | è®¡ç®—æœºå­¦é™¢ | 18 |

### æ•™å¸ˆè´¦å·
| ç”¨æˆ·å | å¯†ç  | å§“å |
|--------|------|------|
| T001 | 123456 | å¼ æ•™æˆ |
| T002 | 123456 | ææ•™æˆ |

### æ•™åŠ¡è´¦å·
| ç”¨æˆ·å | å¯†ç  | å§“å |
|--------|------|------|
| A001 | 123456 | ç‹æ•™åŠ¡ |

---

## ğŸ“± å…¶ä»– API æ–‡æ¡£

é™¤äº† Swagger UIï¼Œè¿˜å¯ä»¥è®¿é—®ï¼š

- **ReDoc**ï¼ˆæ›´ç¾è§‚çš„æ–‡æ¡£ï¼‰ï¼šhttp://localhost:8000/redoc
- **OpenAPI JSON**ï¼ˆæœºå™¨å¯è¯»ï¼‰ï¼šhttp://localhost:8000/openapi.json

---

## ğŸ‰ å¼€å§‹ä½“éªŒ

ç°åœ¨æ‚¨å¯ä»¥ï¼š

1. âœ… ä½¿ç”¨ `2021001/123456` ç™»å½•
2. âœ… é…ç½® Token è®¤è¯
3. âœ… æŸ¥çœ‹å¯é€‰è¯¾ç¨‹
4. âœ… å°è¯•é€‰è¯¾ã€é€€è¯¾
5. âœ… æŸ¥çœ‹ä¸ªäººè¯¾è¡¨
6. âœ… åˆ‡æ¢æ•™å¸ˆè´¦å·æµ‹è¯•æ•™å¸ˆåŠŸèƒ½

**Happy Testingï¼** ğŸš€

æœ‰ä»»ä½•é—®é¢˜ï¼ŒæŸ¥çœ‹å“åº”ä¸­çš„ `message` å­—æ®µè·å–è¯¦ç»†é”™è¯¯ä¿¡æ¯ã€‚
