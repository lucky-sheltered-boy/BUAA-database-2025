### 2. 优秀作业-《系统设计报告-问卷豆》.md

```markdown
# 《数据库系统原理》大作业 - 系统设计报告

## 题目名称：“问卷豆”问卷管理平台

**学号及姓名：**
- 20373087 夏雨阳
- 20373400 欧阳皓东
- 20185614 王默晗

**2022年12月19日**

---

## 组内同学承担任务说明

| | **负责学生** | **备注** |
| :-- | :--- | :--- |
| **子任务1: 系统功能设计与数据库设计** | 夏雨阳, 欧阳皓东 | **夏雨阳**: 数据库逻辑结构设计, 关系模式规范化, 撰写数据库设计报告<br>**欧阳皓东**: 需求分析(数据流图, 数据字典), E-R 图设计 |
| **子任务2: 系统服务器端开发** | 夏雨阳, 欧阳皓东, 王默晗 | **夏雨阳**: 撰写数据库实现报告<br>**欧阳皓东**: 数据库系统服务器部署<br>**王默晗**: 在后端实现前端的请求接口, 管理数据库 |
| **子任务3: 系统客户端开发** | 夏雨阳, 欧阳皓东 | **夏雨阳**: 设计并实现问卷系统<br>**欧阳皓东**: 设计并实现团队系统 |

---

## 一. 需求分析

### 1. 需求描述

本项目实现了问卷调查平台。用户可以在此平台上制作问卷，发放问卷，填写问卷，查看结果。

创建问卷时，用户既可以选择从零开始创建，也可以从自己曾经创建的问卷开始，还可以从公共模板创建，这些模板来自于每个用户的贡献；编辑完问卷后，用户可以随时暂停和开始问卷的发放；收到答卷后，网站将提供数据可视化功能，帮助用户更好地分析数据。

此外，网站实现了团队系统（类似于腾讯问卷提供的团队功能），用于管理团队内部的问卷调查，团队问卷只能在团队内可见，具有较高的保密性。团队支持普通成员，管理员，群主三种权限，其中群主可以任命和解除管理员权限，群主和管理员具有接受成员申请，移除团队成员的权限。这可以较好地模拟现实团队的情况。

### 2. 数据流图

#### 2.1 顶层数据流图

从顶层看，用户可以创建、编辑、发布问卷；填写问卷；修改个人信息；管理团队，包括加入团队，管理团队成员，退出团队；预览问卷；查看问卷答卷结果；对问卷系统做出评价。

`[图1 顶层数据流图]`

#### 2.2 0层数据流图

问卷管理系统分为用户系统，问卷系统，团队系统三个子系统。其中，用户系统功能包括登陆注册，对问卷平台进行评价，修改个人信息，相对于其他系统独立。问卷系统是整个平台的核心，涵盖了一切与问卷相关的操作。团队系统涵盖了团队相关操作，除此之外，它还会调用问卷系统的接口，使得用户可以创建和管理团队问卷。

`[图2 0层数据流图]`

### 3. 数据字典

**(1) 数据组名: 用户信息**
| 数据项名 | 类型 | 宽度 | 值约束/描述 |
| :--- | :--- | :--- | :--- |
| id | int | 32 | 主键 |
| 用户名 | char | 10 | / |
| 密码 | char | 20 | / |
| 电话 | char | 14 | 合法电话号码 |
| 生日 | date | / | YYYY-MM-DD |
| 自我介绍 | varchar | 1024 | 默认空字符串 |
| 邮箱余额 | int | 32 | >= 0 |
| 短信余额 | int | 32 | >= 0 |
| 账户等级 | int | 32 | >= 0 |

**(2) 数据组名: 问卷信息**
| 数据项名 | 类型 | 宽度 | 值约束/描述 |
| :--- | :--- | :--- | :--- |
| id | int | 32 | 主键 |
| 用户 id | int | 32 | 创建者 id |
| 标题 | char | 20 | 默认空字符串 |
| 问卷描述 | char | 255 | 默认空字符串 |
| 创建时间 | datetime | / | 值为创建时刻 |
| 发布状态 | boolean| 1 | / |
| 团队 id | int | 32 | 个人问卷为空 |

*(后续数据字典表格省略，格式同上)*

### 二. 数据库概念模式设计

#### 1. 系统分 E-R 图

一个问卷可以包含多个问题，一个问题可以包含多个问题项。对于选择题，问题项是选项，对于填空题，问题项是每个空对应的小题。模板、模板问题、模板问题项的关系与之类似。

用户可以创建多份个人问卷，也可以在多个团队中创建多份问卷，创建的问卷只会属于一个团队。用户可以填写多份问卷，每份问卷可以被多个用户填写。一个用户可以申请加入多个团队，一个团队有多个用户。

`[图7 分 E-R图]`

#### 2. 系统基本 E-R 图

用户、答案、问题是 1:1:1 关系，因此将实体答案下降为用户回答问题这一关系的属性，答案的时间属性变为用户回答问题这一关系的属性。消除冗余后的基本 E-R 图如下（已经略去属性，详见分E-R图）。

`[图9 系统基本 E-R 图]`

### 三. 数据库逻辑模式设计

#### 1. 数据库关系模式 (由E-R 图得到的关系模式)

-   **实体:**
    -   用户(id, 用户名, 密码, 电话, 生日, 自我介绍, 短信余额, 邮箱余额, 账户等级)
    -   问卷(id, 标题, 描述, 用户 id, 团队 id, 创建时间, 发布状态)
    -   问题(id, 题干, 题号, 问题种类, 问卷 id)
    -   ... (其他实体)
-   **联系:**
    -   用户-团队-问卷(用户 id, 问卷 id, 团队 id)
    -   用户回答题目(用户 id, 题目 id, 回答时间, 答案文本)
    -   ... (其他联系)

#### 2. 关系模式范式等级的判定与规范化 (注: 要规范到3NF)

首先所有关系都不存在元组分量表中套表的情况，因此都是1NF 起步。

对所有的实体，码为id，用户还有用户名这一候选码。各实体除了码引入的函数依赖外没有其他函数依赖，因此所有属性都完全函数依赖于码，且不传递函数依赖于码。因此所有实体关系都至少是3NF。

对二元联系，由于只有两个属性，因此不可能存在部分函数依赖和传递函数依赖，一定是3NF。

对用户回答题目这一联系，唯一的码为(用户id, 题目 id, 回答时间)，唯一的函数依赖为(用户 id, 题目 id, 回答时间) -> 答案文本。因此为3NF。

对用户-团队-问卷这一联系, 唯一的码为问卷 id, 极小函数依赖集为{问卷 id->用户 id, 问卷 id->团队 id}，没有部分函数依赖和传递函数依赖，因此也是3NF。

综上所述，所有实体和联系的关系都至少是3NF。

### 3. 数据库设计优化

1.  **关系模式的简化**: 问卷包含多个问题，问题包含多个问题项等均为 1:n 关系。对这些关系，可以通过在n端实体中加入1端实体的id，避免建立 1:n 联系表。用户-头像和团队-头像均为1:1 联系，因此在用户表中加入头像 id，在团队表中加入头像id，避免建立联系表。
2.  **索引的建立**: 用户登录时，需要根据用户名查找用户，因此在用户名上建立索引。获取某个问卷的所有问题以及相应问题的所有问题项是问卷系统后台收到的最频繁请求。通过在问题表的问卷 id 字段，问题项表的问题 id 字段上建立索引，可以把复杂度降到O(log m + k log n)。
3.  **数据库变量类型选择**: 对于字符串变量，尽量选用 char 而不是 varchar，因为 char 的速度快于 varchar。这样可以用空间换时间。
4.  **数据库存储过程(procedure)**: 存储过程可以将多条sql操作集成到一起，这样可以在一次数据库连接中完成多条指令，并且可以通过事务的封装获得 ACID 特性。
5.  **数据库外模式(视图)**: 对于团队问卷的相关接口，创建团队问卷视图，视图中仅包含问卷表中的团队问卷；对于个人问卷的相关接口，创建个人问卷视图。
6.  **避免 null**: 在建表时尽量设置 not null 约束和默认值。

```

---