# 选课界面优化 - 本专业/跨专业课程区分

## 📅 更新日期
2025-11-02

## 🎯 优化内容

### 1. 前端界面优化
**文件**: `frontend/src/views/student/CourseSelection.vue`

#### 新增功能
- ✅ **标签页切换**
  - 全部课程：显示所有可选课程
  - 本专业课程：仅显示本院系课程
  - 跨专业课程：仅显示跨院系课程

- ✅ **动态计数徽章**
  - 每个标签页显示课程数量
  - 本专业课程使用绿色徽章
  - 跨专业课程使用橙色徽章

- ✅ **名额可视化**
  - 添加进度条显示剩余名额占比
  - 颜色编码：
    - 绿色 (>50%): 名额充足
    - 橙色 (20-50%): 名额紧张
    - 红色 (<20%): 名额极少
  - 名额不足5时文字标红提醒

- ✅ **统计信息**
  - 顶部显示当前筛选下的课程总数
  - 根据标签页类型动态调整颜色

#### 视觉改进
- 优化卡片布局，hover效果更明显
- 添加图标提升视觉识别度
- 响应式设计，适配移动端

### 2. 后端数据增强
**文件**: `database/03_procedures.sql`

#### 存储过程修改
- 修改 `sp_get_available_courses` 存储过程
- 新增返回字段：`总名额`
  - 本院系学生：返回对内名额
  - 跨院系学生：返回对外名额

**修改内容**:
```sql
CASE 
    WHEN c.`院系ID` = v_学生院系ID THEN oi.`对内名额`
    ELSE oi.`对外名额`
END AS `总名额`,
```

### 3. 后端模型更新
**文件**: 
- `backend/app/models/enrollment.py`
- `backend/app/api/students.py`

#### 模型字段新增
```python
class AvailableCourse(BaseModel):
    # ... 现有字段
    total_quota: int  # 新增：总名额
    # ...
```

#### API响应更新
- `/students/{id}/available-courses` 接口现在返回 `total_quota` 字段
- 前端可以计算名额使用率百分比

## 🎨 界面展示

### 标签页结构
```
┌─────────────────────────────────────────────┐
│ 选课中心              共 X 门课程  [刷新]   │
├─────────────────────────────────────────────┤
│ [全部课程 ●]  [本专业课程 ●]  [跨专业课程 ●] │
├─────────────────────────────────────────────┤
│  ┌──────┐  ┌──────┐  ┌──────┐              │
│  │课程A │  │课程B │  │课程C │  ...        │
│  └──────┘  └──────┘  └──────┘              │
└─────────────────────────────────────────────┘
```

### 课程卡片信息
```
┌────────────────────────┐
│ 数据结构     [本院系]  │
├────────────────────────┤
│ 📖 CS101               │
│ 🏆 3.0 学分            │
│ 🏢 计算机学院          │
│ 📍 主楼 301            │
│ 👥 剩余: 15/30         │
│    ████████░░ 50%      │
├────────────────────────┤
│      [➕ 选课]         │
└────────────────────────┘
```

## 🚀 部署步骤

### 1. 更新数据库
```bash
# 进入MySQL
mysql -u root -p

# 切换数据库
USE course_selection_db;

# 重新加载存储过程
SOURCE /path/to/database/03_procedures.sql;

# 验证更新
CALL sp_get_available_courses(16);
# 检查结果中是否包含"总名额"字段
```

### 2. 重启后端
```bash
# 进入backend目录
cd backend

# 重启FastAPI服务
.\backend.ps1
# 或
uvicorn app.main:app --reload
```

### 3. 前端无需操作
- 前端代码已自动更新
- 刷新浏览器即可看到新界面

## ✅ 测试验证

### 功能测试
1. **标签页切换**
   - [ ] 点击"全部课程"显示所有课程
   - [ ] 点击"本专业课程"只显示本院系课程
   - [ ] 点击"跨专业课程"只显示跨院系课程
   - [ ] 徽章数字正确显示

2. **名额显示**
   - [ ] 进度条正确显示剩余名额比例
   - [ ] 颜色根据比例正确变化
   - [ ] 名额<5时文字标红

3. **筛选功能**
   - [ ] 切换标签页数据实时更新
   - [ ] 空状态提示文案正确

### 数据验证
```sql
-- 测试存储过程
CALL sp_get_available_courses(16);

-- 检查返回字段
-- 应包含: 开课实例ID, 课程ID, 课程名称, 学分, 开课院系,
--         教学楼, 房间号, 剩余名额, 总名额, 选课类型
```

## 📊 影响范围

### 修改文件
- ✅ `frontend/src/views/student/CourseSelection.vue` (重写)
- ✅ `database/03_procedures.sql` (新增字段)
- ✅ `backend/app/models/enrollment.py` (新增字段)
- ✅ `backend/app/api/students.py` (新增字段)

### 兼容性
- ✅ 100% 向后兼容
- ✅ 不影响其他模块
- ✅ 已有功能保持不变

## 💡 使用建议

1. **学生选课策略**
   - 优先查看"本专业课程"，这些课程名额更充足
   - "跨专业课程"名额有限，需要尽早选课

2. **名额提醒**
   - 绿色进度条：可以从容选择
   - 橙色进度条：建议尽快选课
   - 红色进度条：名额紧张，立即选课

3. **筛选技巧**
   - 使用标签页快速定位想选的课程类型
   - 关注徽章数字了解各类别课程数量

## 🎉 效果总结

- ✨ **更清晰**: 本专业和跨专业课程一目了然
- ✨ **更直观**: 可视化进度条显示名额紧张程度
- ✨ **更高效**: 标签页快速筛选，节省浏览时间
- ✨ **更友好**: 动态提示和颜色编码提升体验
